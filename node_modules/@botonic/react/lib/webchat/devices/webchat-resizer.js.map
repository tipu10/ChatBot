{"version":3,"sources":["../../../src/webchat/devices/webchat-resizer.js"],"names":["WebchatResizer","currentDevice","host","webchat","onKeyboardShownFn","DEVICES","MOBILE","IPHONE","waitUntilKeyboardIsShown","calculateNewWebchatElementHeight","webchatHeight","clientHeight","keyboardOffset","window","visualViewport","height","innerHeight","newWebchatPercentualHeight","toTwoDecimal","toRound","Math","round","setTimeout","setWebchatElementHeight","newHeight","style"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;IAEaA,c;AACX,0BAAYC,aAAZ,EAA2BC,IAA3B,EAAiC;AAAA;AAC/B,SAAKD,aAAL,GAAqBA,aAArB;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKC,OAAL,GAAe,4BAAkBD,IAAlB,CAAf;AACD;;;;WAED,iBAAQE,iBAAR,EAA2B;AAAA;;AACzB,UAAI,KAAKH,aAAL,KAAuBI,UAAQC,MAAR,CAAeC,MAA1C,EAAkD;AAClD;AACJ;AACA;AACA;;AACI,UAAMC,wBAAwB,GAAG,GAAjC;;AACA,UAAMC,gCAAgC,GAAG,SAAnCA,gCAAmC,GAAM;AAC7C,YAAMC,aAAa,GAAG,KAAI,CAACP,OAAL,CAAaQ,YAAnC,CAD6C,CAE7C;;AACA,YAAMC,cAAc,GACjBC,MAAM,CAACC,cAAP,IAAyBD,MAAM,CAACC,cAAP,CAAsBC,MAAhD,IACAF,MAAM,CAACG,WAFT;AAGA,YAAIC,0BAA0B,GAAGL,cAAc,GAAGF,aAAlD;;AACA,YAAMQ,YAAY,GAAG,SAAfA,YAAe,CAAAC,OAAO;AAAA,iBAAIC,IAAI,CAACC,KAAL,CAAWF,OAAO,GAAG,GAArB,IAA4B,GAAhC;AAAA,SAA5B;;AACAF,QAAAA,0BAA0B,GACxBC,YAAY,CAACD,0BAAD,CAAZ,GAA2C,GAD7C;AAEA,eAAOA,0BAAP;AACD,OAXD;;AAYAK,MAAAA,UAAU,CAAC,YAAM;AACf,QAAA,KAAI,CAACC,uBAAL,WAAgCd,gCAAgC,EAAhE;;AACA,iCAAe,KAAI,CAACP,IAApB;AACAE,QAAAA,iBAAiB;AAClB,OAJS,EAIPI,wBAJO,CAAV;AAKD;;;WAED,kBAAS;AACP,UAAI,KAAKP,aAAL,KAAuBI,UAAQC,MAAR,CAAeC,MAA1C,EAAkD;AAClD,WAAKgB,uBAAL,CAA6B,MAA7B;AACD;;;WAED,iCAAwBC,SAAxB,EAAmC;AACjC,WAAKrB,OAAL,CAAasB,KAAb,CAAmBV,MAAnB,GAA4BS,SAA5B;AACD","sourcesContent":["import { getWebchatElement, scrollToBottom } from '../../util/dom'\nimport { DEVICES } from '.'\n\nexport class WebchatResizer {\n  constructor(currentDevice, host) {\n    this.currentDevice = currentDevice\n    this.host = host\n    this.webchat = getWebchatElement(host)\n  }\n\n  onFocus(onKeyboardShownFn) {\n    if (this.currentDevice !== DEVICES.MOBILE.IPHONE) return\n    /*\n      Based on Tip #4 from https://blog.opendigerati.com/the-eccentric-ways-of-ios-safari-with-the-keyboard-b5aa3f34228d,\n      taking window.innerHeight as the amount of pixels the virtual keyboard adds\n    */\n    const waitUntilKeyboardIsShown = 400\n    const calculateNewWebchatElementHeight = () => {\n      const webchatHeight = this.webchat.clientHeight\n      // Some iOS versions keep track of this height with VisualViewport API: https://stackoverflow.com/a/59056851\n      const keyboardOffset =\n        (window.visualViewport && window.visualViewport.height) ||\n        window.innerHeight\n      let newWebchatPercentualHeight = keyboardOffset / webchatHeight\n      const toTwoDecimal = toRound => Math.round(toRound * 100) / 100\n      newWebchatPercentualHeight =\n        toTwoDecimal(newWebchatPercentualHeight) * 100\n      return newWebchatPercentualHeight\n    }\n    setTimeout(() => {\n      this.setWebchatElementHeight(`${calculateNewWebchatElementHeight()}%`)\n      scrollToBottom(this.host)\n      onKeyboardShownFn()\n    }, waitUntilKeyboardIsShown)\n  }\n\n  onBlur() {\n    if (this.currentDevice !== DEVICES.MOBILE.IPHONE) return\n    this.setWebchatElementHeight('100%')\n  }\n\n  setWebchatElementHeight(newHeight) {\n    this.webchat.style.height = newHeight\n  }\n}\n"],"file":"webchat-resizer.js"}