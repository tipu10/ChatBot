{"version":3,"sources":["../../../src/webchat/devices/scrollbar-controller.js"],"names":["debounced","delay","fn","timerId","args","clearTimeout","setTimeout","stopAtScrollLimit","element","scrollTop","scrollHeight","clientHeight","ScrollbarController","currentDevice","host","webchat","DEVICES","MOBILE","IPHONE","limitScrollBoundaries","ontouchstart","e","handleOnTouchMoveEvents","ontouchmove","onmouseover","handleOnMouseOverEvents","scrollableArea","isScrollable","visible","full","target","currentTarget","toggleOnMouseWheelEvents","parentNode","scrollableContent","hasScrollbar","onmousewheel","preventDefault","toggleOnTouchMoveEvents","frame","dStopAtScrollLimit","window","addEventListener","attachEvent"],"mappings":"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","sourcesContent":["import {\n  getScrollableArea,\n  getScrollableContent,\n  getWebchatElement,\n} from '../../util/dom'\nimport { DEVICES, isMobileDevice } from '.'\n\nconst debounced = (delay, fn) => {\n  let timerId\n  return function (...args) {\n    if (timerId) {\n      clearTimeout(timerId)\n    }\n    timerId = setTimeout(() => {\n      fn(...args)\n      timerId = null\n    }, delay)\n  }\n}\n\nconst stopAtScrollLimit = element => {\n  if (element.scrollTop === 0) element.scrollTop = 1\n  if (element.scrollHeight - element.scrollTop === element.clientHeight)\n    element.scrollTop -= 1\n}\n\nexport class ScrollbarController {\n  constructor(currentDevice, host) {\n    this.currentDevice = currentDevice\n    this.webchat = getWebchatElement(host)\n  }\n\n  handleScrollEvents() {\n    /*\n      It handles scroll events for Mobile/Desktop.\n      \"ontouchmove\" is the phone equivalent for \"onmouseover\"\n    */\n    if (isMobileDevice()) {\n      if (this.currentDevice !== DEVICES.MOBILE.IPHONE) return\n      this.limitScrollBoundaries()\n      this.webchat.ontouchstart = e => {\n        this.handleOnTouchMoveEvents(e)\n      }\n      this.webchat.ontouchmove = e => {\n        this.handleOnTouchMoveEvents(e)\n      }\n    } else {\n      this.webchat.onmouseover = e => this.handleOnMouseOverEvents(e)\n    }\n  }\n\n  hasScrollbar() {\n    const scrollableArea = getScrollableArea(this.webchat)\n    const isScrollable =\n      scrollableArea.visible.clientHeight - scrollableArea.full.clientHeight < 0\n    return isScrollable\n  }\n\n  handleOnMouseOverEvents(e) {\n    let target = e.currentTarget\n    while (target) {\n      this.toggleOnMouseWheelEvents()\n      target = target.parentNode\n    }\n  }\n\n  toggleOnMouseWheelEvents() {\n    const scrollableContent = getScrollableContent(this.webchat)\n    if (this.hasScrollbar()) {\n      scrollableContent.onmousewheel = {}\n      return\n    }\n    scrollableContent.onmousewheel = e => e.preventDefault()\n  }\n\n  handleOnTouchMoveEvents(e) {\n    this.toggleOnTouchMoveEvents()\n  }\n\n  toggleOnTouchMoveEvents() {\n    if (this.hasScrollbar()) {\n      this.webchat.ontouchmove = {}\n      this.webchat.ontouchstart = {}\n      return\n    }\n    this.webchat.ontouchmove = e => {\n      if (e.target === e.currentTarget) e.preventDefault()\n    }\n  }\n\n  limitScrollBoundaries() {\n    if (this.currentDevice !== DEVICES.MOBILE.IPHONE) return\n    /*\n      It adds a bounce effect when top or bottom limits of the scrollbar are reached for iOS,\n      as an alternative of overscroll-behavior (https://developer.mozilla.org/en-US/docs/Web/CSS/overscroll-behavior)\n    */\n    const frame = getScrollableArea(this.webchat).visible\n    const dStopAtScrollLimit = debounced(100, stopAtScrollLimit)\n    if (frame) {\n      if (window.addEventListener) {\n        frame.addEventListener('scroll', () => dStopAtScrollLimit(frame), true)\n      } else if (window.attachEvent) {\n        frame.attachEvent('scroll', () => dStopAtScrollLimit(frame))\n      }\n    }\n  }\n}\n"],"file":"scrollbar-controller.js"}